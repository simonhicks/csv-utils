#!/bin/bash

show_help() {
  echo ""
  echo "USAGE: $0 [-h] cols"
  echo ""
  echo "  cols : a comma seperated list of the columns to keep"
  echo "  h    : show this help text"
}

while getopts "h" opt
do
  case "$opt" in
    h)
      show_help
      exit 0
      ;;
  esac
done
shift $((OPTIND-1))

if [ "$1" == "" ]
then
  >&2 echo "ERROR: No columns selected"
  >&2 show_help
  exit 1
fi

awk -F, -v cols="$1" '
BEGIN {
  numberOfColumns = split(cols, columns)
  for (i=1; i<=numberOfColumns ; i++) {
    column = columns[i]
    outputIndex[column] = i
  }
}
NR==1 {
  for (f=1; f<=NF; f++) {
    if ($f in outputIndex) {
      inputIndex[outputIndex[$f]] = f
    }
  }
}
{
  sep = ""
  for (f=1; f<=numberOfColumns; f++) {
    printf("%c%s", sep, $inputIndex[f])
    sep=FS
  }
  print ""
}
'
